<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/mystyle-main.css"/>
    <title>Cart</title>
    <style>
        .product-card-c {
    background: rgb(255, 255, 255);
    border-radius: 5px;
    border: 2px solid #d8d8d8; 
    padding: 10px;
    margin: 10px; /* Adds spacing between cards */
    min-width: 250px; /* Minimum width for product cards */
    max-width: 250px; 
    min-width: 250px;/* Minimum width for product cards */
    text-align: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0); 
}
    </style>
</head>
<body>
    <header>
        <table class="header" border="0">
            <tr>
                <td class="logo"><a href="index.html"><img src="images/logov2.png" alt="e-store"></a></td>
                <td>
                    <div class="search">
                        <input type="text" id="searchInput" placeholder='search...'>
                        <button type="submit" onclick="performSearch()"><img src="images/search-solid.svg" alt="search"></button>
                    </div>
                </td>
                <td>
                    <div style="padding-left: 30px; text-align: center; position: relative;">
                        <a href="cart.html">
                            <img src="images/shopping-cart-3.png" alt="CART" style="width: 30px; height: 30px;"><br>
                            Cart <div id="cart-count" class="cart-count" style="display: none;"></div>
                        </a>
                    </div>
                </td>
                <td>
                    <div style="padding-left: 30px; text-align: center; position: relative;">
                        <a href="wishlist.html">
                            <img src="images/like-2.png" alt="wishList" style="width: 30px; height: 30px;"><br>
                            WishList <div id="wishList-count" class="wishList-count" style="display: none;"></div>
                        </a>
                    </div>
                </td>
                <td>
                    <div style="display: flex; align-items: center; justify-content: flex-end; position: relative; width: 100%; margin:auto;">
                        <a href="#" id="avatar-link" style="margin-right: 10px; display: none;">
                            <img src="images/profile.png" alt="my profile" style="height:50px; width:50px;">
                        </a>
                        <div class="signin-out">
                            <a href="signin.html" id="signin-link">
                                <img src="images/signin-av.png" alt="sign in"><br>Sign In
                            </a>
                            <div style="display: none; position: absolute; top: 60px; left: -10px; width: 120px;">
                                <button id="signout-button" style="display: flex; align-items: center; background-color: rgb(4, 120, 221); border: none; color: white; padding: 5px; border-radius: 5px;">
                                    <h3 style="margin: 0;">Sign Out</h3>
                                    <img src="images/logout.png" alt="sign out" style="width: 30px; height: 30px; margin-left: 5px;">
                                </button>
                            </div>
                        </div>
                    </div>
                </td>  
            </tr>
        </table>
    </header>
    
    <div class="cart-title"><h2>Shopping Cart</h2></div>
    
    <div class="cart">
        <div class="cart-container">
            <div id="cart-items"></div>
            <div id="cart-summary">
                <p style="font-size: 25px;"><b>Order Summary</b></p>
                <br>
                <div class="total-items">
                    <h3>Total Items</h3>
                    <h3 id="total-items-count">0</h3>
                </div>
                <br>
                <div class="shipping-fee">
                    <h3>Shipping Fee</h3>
                    <h3 style="color: green;">Free</h3>
                </div>
                <br>
                <div class="total">
                    <h3>Total Price</h3><h3><span id="total-price">0.00 SR</span></h3>
                </div>
                <div id="pay-div"><button id="pay-button" onclick="goToPaymentPage()">Proceed to Pay</button></div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-container">
            <!-- Footer Content Here -->
        </div>
    </footer>

    <script>
        let totalProductsInCart = parseInt(localStorage.getItem('totalProductsInCart')) || 0;
        let totalProductsInWishList = parseInt(localStorage.getItem('totalProductsInWishList')) || 0;

        // Updated cart products with quantity
        const cartProducts = [
            { id: 1, name: 'PlayStation 5 Console (Disc Version)', oldPrice: 100, newPrice: 80, imageUrl: 'images/pic/pic.png', quantity: 1 },
            { id: 17, name: 'Alpha 7R V Camera', oldPrice: 77, newPrice: 60, imageUrl: 'images/pic/17-c.png', quantity: 2 },
        ];

        // Update cart icon
        function updateCartIcon() {
            const cartIcon = document.getElementById('cart-count');
            cartIcon.textContent = totalProductsInCart > 0 ? totalProductsInCart : '';
            cartIcon.style.display = totalProductsInCart > 0 ? 'block' : 'none';
            localStorage.setItem('totalProductsInCart', totalProductsInCart);
        }

        // Update wishlist icon
        function updateWishlistIcon() {
            const wishListIcon = document.getElementById('wishList-count');
            wishListIcon.textContent = totalProductsInWishList > 0 ? totalProductsInWishList : '';
            wishListIcon.style.display = totalProductsInWishList > 0 ? 'block' : 'none';
            localStorage.setItem('totalProductsInWishList', totalProductsInWishList);
        }

        // Display products in the cart
        function displayProducts(productArray) {
            const productContainer = document.getElementById('cart-items');
            const cartSummary = document.getElementById('cart-summary');
            productContainer.innerHTML = '';
            let total = 0;
            let totalItems = 0;

            if (productArray.length === 0) {
                productContainer.innerHTML = `
                    <center>
                        <div>
                            <h1>Your Cart is Empty</h1>
                            <br>
                            <button style="padding: 15px 30px; font-size: 23px; background-color: #006eff; color: white; border: none; border-radius: 5px; cursor: pointer;" onclick="location.href='index.html'">
                                Start Shopping
                            </button>
                        </div>
                    </center>
                `;
                cartSummary.style.display = 'none';
                document.getElementById('total-price').textContent = `0.00 SR`;
                document.getElementById('total-items-count').textContent = `0`;
                return;
            }

            cartSummary.style.display = 'block';

            productArray.forEach(product => {
                total += product.newPrice * product.quantity;
                totalItems += product.quantity;

                const productCard = document.createElement('div');
                productCard.className = 'product-card-c';
                productCard.innerHTML = `
                    <img src="${product.imageUrl}" alt="Product ${product.id}" class="product-image" style="width: 150px;">
                    <div class="cart-product-details">
                        <div class="product-name"><h3>${product.name}</h3></div>
                        <div id="product-price">
                            <p class="old-price">${product.oldPrice.toFixed(2)} SR</p>
                            <p class="new-price">${product.newPrice.toFixed(2)} SR</p>
                            <div class="product-quantity">
                                <button class="remove" onclick="removeFromCart(${product.id})"><i class="fa-solid fa-trash"></i></button>
                                <button class="decrease" onclick="decreaseQuantity(${product.id})" id="decrease-${product.id}" ${product.quantity === 1 ? 'disabled' : ''}>-</button>
                                <span id="quantity-${product.id}">${product.quantity}</span>
                                <button class="increase" onclick="increaseQuantity(${product.id})">+</button>
                            </div>
                        </div>
                    </div>
                `;
                productContainer.appendChild(productCard);
            });

            document.getElementById('total-price').textContent = `${total.toFixed(2)} SR`;
            document.getElementById('total-items-count').textContent = totalItems;
        }

        // Increase product quantity
        function increaseQuantity(productId) {
            const product = cartProducts.find(item => item.id === productId);
            if (product) {
                product.quantity++;
                displayProducts(cartProducts); // Re-render products
            }
        }

        // Decrease product quantity
        function decreaseQuantity(productId) {
            const product = cartProducts.find(item => item.id === productId);
            if (product && product.quantity > 1) {
                product.quantity--;
                displayProducts(cartProducts); // Re-render products
            }
        }

        // Remove product from the cart
        function removeFromCart(productId) {
            const index = cartProducts.findIndex(item => item.id === productId);
            if (index !== -1) {
                cartProducts.splice(index, 1);
                displayProducts(cartProducts);
            }
        }

        // Sign out functionality
        document.getElementById('signout-button').addEventListener('click', function() {
            localStorage.setItem('isSignedIn', 'false'); // Update sign-in status
            alert('You have signed out.'); // Alert user
            updateSignInUI(); // Update UI after signing out
            const signoutDiv = document.querySelector('.signin-out div');
            signoutDiv.style.display = 'none'; // Hide the sign-out button
        });

        // Update the sign-in UI based on status
        function updateSignInUI() {
            const isSignedIn = localStorage.getItem('isSignedIn');
            const avatarLink = document.getElementById('avatar-link');
            const signinLink = document.getElementById('signin-link');

            if (isSignedIn === 'true') {
                avatarLink.style.display = 'block'; // Show the avatar
                signinLink.style.display = 'none';   // Hide the sign-in link
                avatarLink.href = 'profile.html';    // Change to the desired profile page
            } else {
                avatarLink.style.display = 'none';    // Hide the avatar
                signinLink.style.display = 'block';   // Show the sign-in link
            }
        }

        // Call the function to update the UI on page load
        updateSignInUI();

        // Perform search
        function performSearch() {
            const searchInput = document.getElementById('searchInput').value;
            if (searchInput) {
                window.location.href = `search.html?query=${encodeURIComponent(searchInput)}`;
            } else {
                alert("Please enter a search term.");
            }
        }

        // Go to payment page if signed in
        function goToPaymentPage() {
            const isSignedIn = localStorage.getItem('isSignedIn');
            if (isSignedIn === 'true') {
                window.location.href = 'payment.html'; // Your payment page URL
            } else {
                alert("You need to sign in first.");
                window.location.href = 'signin.html'; // Your sign-in page URL
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            displayProducts(cartProducts);
            updateCartIcon();
            updateWishlistIcon();
        });
    </script>
</body>
</html>
