<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/mystyle-main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Search Results</title>
</head>
<body>
    <header>
        <table class="header" border="0">
            <tr>
                <td class="logo"><a href="index.html"><img src="images/logov2.png"  alt="e-store"></a></td>
                <td>
                    <div class="search">
                        <input type="text" id="searchInput" placeholder='search...'>
                        <button type="submit" onclick="performSearch()"><img src="images/search-solid.svg" alt="search"></button>
                    </div>
                </td>
               <td>
                <div style="padding-left: 30px; text-align: center; position: relative;">
                    <a href="cart.html">
                        <img src="images/shopping-cart-3.png" alt="CART" style="width: 30px; height: 30px;"><br>
                        Cart <div id="cart-count" class="cart-count" style="display: none;"><script>totalProductsInCart</script></div>
                    </a>
                </div>
                </td>
                <td>
                    <div style="padding-left: 30px; text-align: center; position: relative;">
                        <a href="wishlist.html">
                            <img src="images/like-2.png" alt="wishList" style="width: 30px; height: 30px;"><br>
                            WishList <div id="wishList-count" class="wishList-count" style="display: none;"><script>totalProductsInWishList</script></div>
                        </a>
                    </div>
                </td>
                <td>
                    <div style="display: flex; align-items: center; justify-content: flex-end; position: relative; width: 100%; margin:auto;">
                        <a href="#" id="avatar-link" style="margin-right: 10px; display: none;">
                            <img src="images/profile.png" alt="my profile" style="height:50px; width:50px;">
                        </a>
                        <div class="signin-out">
                            <a href="signin.html" id="signin-link">
                                <img src="images/signin-av.png" alt="sign in"><br>Sign In
                            </a>
                            <div style="display: none; position: absolute; top: 60px; left: -10px; width: 120px;">
                                <button id="signout-button" style="display: flex; align-items: center; background-color: rgb(4, 120, 221); border: none; color: white; padding: 5px; border-radius: 5px;">
                                    <h3 style="margin: 0;">Sign Out</h3>
                                    <img src="images/logout.png" alt="sign out" style="width: 30px; height: 30px; margin-left: 5px;">
                                </button>
                            </div>
                        </div>
                    </div>
                </td>              
            </tr>
        </table>
    </header>

    <div class="container">
        <div class="filters">
            <h2>Filters</h2>
            <div class="filter-category">
                <h3>Category</h3>
                <!-- You can add actual categories if necessary -->
                <label><input type="checkbox" value="GameConsoles" class="category-filter">Game Consoles</label><br><br>
                <label><input type="checkbox" value="TV" class="category-filter">TV's</label><br><br>
                <label><input type="checkbox" value="Home Appliances" class="category-filter">Home Appliances</label><br><br>
                <label><input type="checkbox" value="Cameras" class="category-filter">Cameras</label><br><br>
            </div>
            <div class="filter-price">
                <h3>Price Range</h3>
                <input type="range" min="0" max="300" id="priceRange" value="300" step="10" oninput="updatePriceLabel()">
                <span id="priceLabel">0 SR - 300 SR</span>
            </div>
            <button id="applyFilters">Apply Filters</button>
        </div>

        <div class="results">
            <h2 id="resultsTitle"></h2>
            <div class="category-container">
                <div class="product-flex"></div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <table border="0">
            <tr>
               <div>
                <td class="logo-f"><img src="images/logov2.png" height="150px" width="150px" alt="e-store"></td>
               </div>
                <div class="footer-element">
                    <td><h3>Find Us</h3></td>
                <td>
                    <div class="social-media"><img src="images/social-media/twitter (1).png" alt="X"></div>
                </td>
                <td>
                    <div class="social-media"><img src="images/social-media/facebook (1).png" alt="facebook"></div>
                </td>
                <td>
                    <div class="social-media"><img src="images/social-media/tik-tok (1).png" alt="tiktok"></div>
                </td>
                <td>
                    <div class="social-media"><img src="images/social-media/instagram (1).png" alt="instagram"></div>
                </td>
                </div>
                <td><div  class="footer-element" style="width:100px;">
                    <td><h3>E-mail: </h3></td>
                    <td><a href="mailto:myEmail@example.com" style="text-decoration: none; color:#00e1ff;"><h3>myEmail@example.com</h3></a></td>
                </div></td>
               
                <td><div  class="footer-element" style="width:100px;">
                    <td><h3>Call Center: </h3></td>
                    <td><h3 style="color:#00e1ff;">8001207669</h3></td>
                </div></td>
               
                <td><div  class="footer-element" style="width:100px;">
                    <td><h3 style="color:#00e1ff;">About Us</h3></td>
                </div></td>
                
            </tr>
        </table>
    </footer>

    <script src="search.js"></script>
</body>
</html>

<script>

    let totalProductsInCart = parseInt(localStorage.getItem('totalProductsInCart')) || 0;
    let totalProductsInWishList = parseInt(localStorage.getItem('totalProductsInWishList')) || 0;
    
    
    // Function to update the cart count in the UI and localStorage
    function updateCartIcon() {
        const cartIcon = document.getElementById('cart-count'); // Get the cart count element
        cartIcon.textContent = totalProductsInCart > 0 ? totalProductsInCart : ''; // Update the text content
        cartIcon.style.display = totalProductsInCart > 0 ? 'block' : 'none'; // Show or hide cart count
        localStorage.setItem('totalProductsInCart', totalProductsInCart); // Save to localStorage
    }
    
    function updateWishListIcon() {
        const wishListIcon = document.getElementById('wishList-count'); // Get the wishlist count element
        wishListIcon.textContent = totalProductsInWishList > 0 ? totalProductsInWishList : ''; // Update the text content
        wishListIcon.style.display = totalProductsInWishList > 0 ? 'block' : 'none'; // Show or hide wishlist count
        localStorage.setItem('totalProductsInWishList', totalProductsInWishList); // Save to localStorage
    }
    
    
    // Function to add products to the cart
    function buyProduct(productId) {
        totalProductsInCart++; // Increment the total products in cart
        updateCartIcon(); // Update the cart icon
    
        // Change the button text to "Added to Cart"
        const buyButton = document.querySelector(`#buy[data-product-id="${productId}"]`);
        if (buyButton) {
            buyButton.textContent = "Added to Cart";
            buyButton.style.backgroundColor = "#4CAF50"; // Change button color to green
            buyButton.disabled = true; // Optionally disable the button
        }
    
        alert(`Product ${productId} purchased!`);
    }
    
    function addWishList(productId) {
        totalProductsInWishList++; // Increment the total products in wishlist
        updateWishListIcon(); // Update the wishlist icon
    
        // Change the heart icon to "like-solid"
        const heartButton = document.querySelector(`#wish[data-product-id="${productId}"]`);
        if (heartButton) {
            heartButton.innerHTML = '<i class="fa-solid fa-heart" style="color: white;"></i>'; // Change to solid heart
        }
    
        alert(`Product ${productId} added to WishList!`);
    }
    
    function performSearch() {
    const searchInput = document.getElementById('searchInput').value;
    if (searchInput) {
        // Redirect to search.html with the search term as a query parameter
        window.location.href = `search.html?query=${encodeURIComponent(searchInput)}`;
    } else {
        alert("Please enter a search term.");
    }
} 
    
    
    function performSearch() {
        const searchInput = document.getElementById('searchInput').value;
        if (searchInput) {
            // Redirect to search.html with the search term as a query parameter
            window.location.href = `search.html?query=${encodeURIComponent(searchInput)}`;
        } else {
            alert("Please enter a search term.");
        }
    }
            // Function to display products in a specified container
            function displayProducts(productArray) {
    const productContainer = document.querySelector('.product-flex'); // Get the correct container
    productContainer.innerHTML = ''; // Clear previous products

    productArray.forEach(product => {
        const productCard = document.createElement('div');
        productCard.className = 'product-card';
        productCard.innerHTML = `
            <a href="product-detail.html?id=${product.id}">
                <img src="${product.imageUrl}" alt="Product ${product.id}" class="product-image" style="width: 150px;">
                <h3>${product.name}</h3>
                <p class="old-price">SR${product.oldPrice.toFixed(2)}</p>
                <p class="new-price">SR${product.newPrice.toFixed(2)} (Discount: ${product.discount}%)</p>
            </a>
            <div style="display:flex;">
                <button id="wish" data-product-id="${product.id}" onclick="addWishList(${product.id})" style="border-radius:50px;">
                    <i class="fa-regular fa-heart"></i>
                </button>
                <button id="buy" data-product-id="${product.id}" onclick="buyProduct(${product.id})" style="width:80%; font-size:15px;">
                    Add to Cart &nbsp;<i class="fa-sharp fa-solid fa-cart-plus"></i>
                </button>
            </div>
        `;
        productContainer.appendChild(productCard);
    });
}

// Function to filter and display results based on the search input
document.getElementById('applyFilters').addEventListener('click', function() {
    filterAndDisplayResults(); // Call the filtering function when the button is clicked
});

// Function to filter and display results based on selected filters
function filterAndDisplayResults() {
    const selectedCategories = Array.from(document.querySelectorAll('.category-filter:checked')).map(cb => cb.value);
    const maxPrice = parseInt(document.getElementById('priceRange').value);
    const query = getQueryParam('query').toLowerCase(); // Ensure to get the search query

    // Assuming `Products` is your array of products
    const filteredProducts = Products.filter(product => {
        const matchesQuery = product.name.toLowerCase().includes(query);
        const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(product.category);
        const matchesPrice = product.newPrice <= maxPrice;
        return matchesQuery && matchesCategory && matchesPrice;
    });

    displayProducts(filteredProducts); // Call to display filtered products
}

// Helper function to get query parameter from the URL
function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

// Call this function when the page loads to display the results
window.onload = () => {
    const query = getQueryParam('query');
    document.getElementById('resultsTitle').textContent = `Search Results for: ${query}`;
    filterAndDisplayResults(); // Show the filtered results based on the search
    updateCartIcon();
    updateWishListIcon();
};
    
function updatePriceLabel() {
    const priceRange = document.getElementById('priceRange');
    const maxPrice = priceRange.value; // Get the current value of the slider
    const minPrice = 0; // Set minimum price (can also be dynamic if needed)

    // Update the label with the current range
    document.getElementById('priceLabel').textContent = `${minPrice} SR - ${maxPrice} SR`;
}

    
           document.getElementById('avatar-link').addEventListener('click', function(event) {
        event.preventDefault(); // Prevent the default link behavior
        const signoutDiv = document.querySelector('.signin-out div'); // Select the sign-out button's container
        signoutDiv.style.display = signoutDiv.style.display === 'none' ? 'flex' : 'none'; // Toggle visibility
    });
    
    // Sign out functionality
    document.getElementById('signout-button').addEventListener('click', function() {
        localStorage.setItem('isSignedIn', 'false'); // Update sign-in status
        alert('You have signed out.'); // Alert user
        updateSignInUI(); // Update UI after signing out
        const signoutDiv = document.querySelector('.signout');
        document.getElementById('signout-container').style.display = 'none'; // Hide the sign-out button
    });
           
    
  
    
    
    // Initialize by displaying all products
    displayAllProducts();
    updateCartIcon();
    updateWishListIcon();
        </script>

<script>
    // Check the sign-in status on page load
    const isSignedIn = localStorage.getItem('isSignedIn');

    // Reset sign-in status when the page is being unloaded

    // Update UI based on sign-in status
    function updateSignInUI() {
    const isSignedIn = localStorage.getItem('isSignedIn');
    const avatarLink = document.getElementById('avatar-link');
    const signinLink = document.getElementById('signin-link');

    if (isSignedIn === 'true') {
        avatarLink.style.display = 'block'; // Show the avatar
        signinLink.style.display = 'none';   // Hide the sign-in link
        avatarLink.href = 'profile.html';    // Change to the desired profile page
    } else {
        avatarLink.style.display = 'none';    // Hide the avatar
        signinLink.style.display = 'block';    // Show the sign-in link
    }
}

    // Call the function to update the UI
    updateSignInUI();
</script>