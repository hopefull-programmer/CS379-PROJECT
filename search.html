<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/mystyle-main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Search Results</title>
    <style>
        .container {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    padding: 20px;
}

/* Style for the filters container */
.filters {
    width: 300px; /* Adjust this to control the width of the filter sidebar */
    padding: 20px;
    border-right: 1px solid #ddd; /* Optional: adds a separator between filters and products */
}

/* Style for the results container (products) */
.results {
    flex-grow: 1; /* This will make the results container take the remaining space */
    padding: 20px;
}

/* Optionally, style the individual filter sections */
.filter-category, .filter-company, .filter-price {
    margin-bottom: 20px;
}

/* Style the filter headings */
h3 {
    margin-bottom: 10px;
}

/* Style the range input (Price Range) */
input[type="range"] {
    width: 100%;
}

/* Responsive behavior */
@media screen and (max-width: 768px) {
    .container {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .filters {
        width: 100%;
        border-right: none;
    }
    
    .results {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <header>
        <table class="header" border="0">
            <tr>
                <td class="logo"><a href="index.html"><img src="images/logov2.png"  alt="e-store"></a></td>
                <td>
                    <div class="search">
                        <input type="text" id="searchInput" placeholder='search...'>
                        <button type="submit" onclick="performSearch()"><img src="images/search-solid.svg" alt="search"></button>
                    </div>
                </td>
               <td>
                <div style="padding-left: 30px; text-align: center; position: relative;">
                    <a href="cart.html">
                        <img src="images/shopping-cart-3.png" alt="CART" style="width: 35px; height: 35px;"><br>
                        Cart <div id="cart-count" class="cart-count" style="display: none;"><script>totalProductsInCart</script></div>
                    </a>
                </div>
                </td>
                <td>
                    <div style="padding-left: 30px; text-align: center; position: relative;">
                        <a href="wishlist.html">
                            <img src="images/like-2.png" alt="wishList" style="width: 35px; height: 35px;"><br>
                            WishList <div id="wishList-count" class="wishList-count" style="display: none;"><script>totalProductsInWishList</script></div>
                        </a>
                    </div>
                </td>
                <td>
                    <div class="sign-in-out"   style="display: flex; align-items: center; justify-content: flex-end; position: relative; width: 100%; margin:auto;">
                        <a href="#" id="avatar-link" style="margin-right: 10px; display: none;">
                            <img src="images/profile.png" alt="my profile" style="height:35px; width:35px;"><br>
                            Account
                        </a>
                        <div class="signin-out">
                            <a href="signin.html" id="signin-link">
                                <img src="images/signin-av.png" alt="sign in"><br>Sign In
                            </a>
                            <div style="display: none; position: absolute; top: 60px; left: -10px; width: 120px;">
                                <button id="signout-button" style="display: flex; align-items: center; background-color: rgb(4, 120, 221); border: none; color: white; border-radius: 5px;">
                                    <h5 style="margin: 0;">Sign Out</h5>
                                    <img src="images/logout.png" alt="sign out" style="width: 35px; height: 35px; margin-left: 5px;">
                                </button>
                            </div>
                        </div>
                    </div>
                </td> 
                <td>
                    <div id="add-product"  style="padding-left: 30px; text-align: center; position: relative; display: none;">
                        <a href="Addproduct.html">
                            <img src="images/add.png" alt="wishList" style="width: 35px; height: 35px;"><br>
                            Add Products
                        </a>
                    </div>
                </td> 
                <td>
                    <div id="delete-product"  style="padding-left: 30px; text-align: center; position: relative; display: none;">
                        <a href="Deleteproduct.html">
                            <img src="images/delete.png" alt="delete product" style="width: 35px; height: 35px;"><br>
                            Delete Products
                        </a>
                    </div>
                </td> 
                <td>
                    <div id="statistics"  style="padding-left: 30px; text-align: center; position: relative; display: none;">
                        <a href="statistics.html">
                            <img src="images/chart.png" alt="delete product" style="width: 35px; height:35px;"><br>
                            Financial Statistics
                        </a>
                    </div>
                </td>            
            </tr>
        </table>
    </header>
    <div class="nav-container">
        <nav>
            <table class="categories" border="0">
                <tr>
                    <td class="c-item"><h4><a href="HA.html">Home Appliances</a></h4></td>
                    <td class="c-item"><h4><a href="TV.html">TV's</a></h4></td>
                    <td class="c-item"><h4><a href="Cameras-category.html">Cameras</a></h4></td>
                    <td class="c-item"><h4><a href="GC-category.html">Games Consoles</a></h4></td>
                </tr>
            </table>
        </nav>
    </div>

    <div class="container">
        <div class="filters">
            <h2>Filters</h2>
            <!-- Merged Category and Price Range Filter -->
            <div class="filter-options">
                <!-- Category Filter -->
                <div class="filter-category">
                    <h3>Category</h3><br>
                    <label><input type="checkbox" value="GameConsoles" class="category-filter"> Game Consoles</label><br>
                    <label><input type="checkbox" value="TV" class="category-filter"> TVs</label><br>
                    <label><input type="checkbox" value="HomeAppliances" class="category-filter"> Home Appliances</label><br>
                    <label><input type="checkbox" value="Cameras" class="category-filter"> Cameras</label><br>
                </div>
                <!-- Company Filter -->
                <div class="filter-company">
                    <h3>Company</h3>
                    <label><input type="checkbox" value="Sony" class="company-filter"> Sony</label><br><br>
                    <label><input type="checkbox" value="Microsoft" class="company-filter"> Microsoft</label><br><br>
                    <label><input type="checkbox" value="Nintendo" class="company-filter"> Nintendo</label><br><br>
                    <label><input type="checkbox" value="Valve" class="company-filter"> Valve</label><br><br>
                </div>
                <!-- Price Range Filter -->
                <div class="filter-price">
                    <h3>Price Range</h3>
                    <input type="range" min="0" max="300" id="priceRange" value="300" step="10" oninput="updatePriceLabel()"><br>
                    <span id="priceLabel">0 SR - 300 SR</span>
                </div>
                <div class="star-rating-filter">
                    <h3>Stars</h3>
                    <i class="star" data-value="1">★</i>
                    <i class="star" data-value="2">★</i>
                    <i class="star" data-value="3">★</i>
                    <i class="star" data-value="4">★</i>
                    <i class="star" data-value="5">★</i>
                </div>
            </div>
        
            <br>
            <button class="applyFilters" id="applyFilters">Apply Filters</button>
        </div>
    
        <div class="results">
            <h2 id="resultsTitle"></h2>
            <div class="category-container">
                <div class="product-flex"></div>
            </div>
        </div>
    </div>
    

    <footer class="footer">
        <div class="footer-container">
            <!-- Logo Section -->
            <div class="footer-logo">
                <img src="images/logov2.png" height="150px" width="150px" alt="e-store">
            </div>
    
            <!-- Footer Categories -->
            <div class="footer-category">
                <h3>Home Appliances</h3>
                <ul>
                    <li><a href="HA.html">Refrigerators</a></li>
                    <li><a href="HA.html">Washing Machines</a></li>
                    <li><a href="HA.html">Microwaves</a></li>
                    <li><a href="HA.html">Air Conditioners</a></li>
                </ul>
            </div>
    
            <div class="footer-category">
                <h3>TVs</h3>
                <ul>
                    <li><a href="TV.html">Smart TVs</a></li>
                    <li><a href="TV.html">LED TVs</a></li>
                    <li><a href="TV.html">OLED TVs</a></li>
                    <li><a href="TV.html">4K TVs</a></li>
                </ul>
            </div>
    
            <div class="footer-category">
                <h3>Game Consoles</h3>
                <ul>
                    <li><a href="GC-category.html">PlayStation</a></li>
                    <li><a href="GC-category.html">Xbox</a></li>
                    <li><a href="GC-category.html">Nintendo</a></li>
                    <li><a href="GC-category.html">Handheld Consoles</a></li>
                </ul>
            </div>
    
            <div class="footer-category">
                <h3>Cameras</h3>
                <ul>
                    <li><a href="Cameras-category.html">DSLR Cameras</a></li>
                    <li><a href="Cameras-category.html">Mirrorless Cameras</a></li>
                    <li><a href="Cameras-category.html">Action Cameras</a></li>
                    <li><a href="Cameras-category.html">Bridge Cameras</a></li>
                </ul>
            </div>
    
            <!-- Contact and Social Section -->
            <div class="footer-contact">
                <div class="social-media">
                    <h3>Find Us</h3>
                    <a href="https://x.com" target="_blank"><img src="images/social-media/twitter (1).png" alt="X"></a>
                    <a href="https://www.facebook.com" target="_blank"><img src="images/social-media/facebook (1).png" alt="Facebook"></a>
                    <a href="https://www.tiktok.com" target="_blank"><img src="images/social-media/tik-tok (1).png" alt="TikTok"></a>
                    <a href="https://www.instagram.com" target="_blank"><img src="images/social-media/instagram (1).png" alt="Instagram"></a>
                </div>
    
                <h3>Email: <a href="mailto:myEmail@example.com" class="footer-email">myEmail@example.com</a></h3>
                <h3>Call Center: <span class="footer-phone">8521336588</span></h3>
            </div>
    
            <!-- Footer About Us Section -->
            <div class="footer-about">
                <h3>About</h3>
                <ul>
                <li><a href="about-us.html">About Us</a></li>
                </ul>
            </div>
        </div>
       
    </footer>

<script src="search.js"></script>

</body>
</html>


<script>

    let totalProductsInCart = parseInt(localStorage.getItem('totalProductsInCart')) || 0;
let totalProductsInWishList = parseInt(localStorage.getItem('totalProductsInWishList')) || 0;

// Function to update the cart count in the UI and localStorage
function updateCartIcon() {
    const cartIcon = document.getElementById('cart-count'); // Get the cart count element
    cartIcon.textContent = totalProductsInCart > 0 ? totalProductsInCart : ''; // Update the text content
    cartIcon.style.display = totalProductsInCart > 0 ? 'block' : 'none'; // Show or hide cart count
    localStorage.setItem('totalProductsInCart', totalProductsInCart); // Save to localStorage
}

function updateWishListIcon() {
    const wishListIcon = document.getElementById('wishList-count'); // Get the wishlist count element
    wishListIcon.textContent = totalProductsInWishList > 0 ? totalProductsInWishList : ''; // Update the text content
    wishListIcon.style.display = totalProductsInWishList > 0 ? 'block' : 'none'; // Show or hide wishlist count
    localStorage.setItem('totalProductsInWishList', totalProductsInWishList); // Save to localStorage
}

// Function to add products to the cart
function buyProduct(productId) {
    totalProductsInCart++; // Increment the total products in cart
    updateCartIcon(); // Update the cart icon

    // Change the button text to "Added to Cart"
    const buyButton = document.querySelector(`#buy[data-product-id="${productId}"]`);
    if (buyButton) {
        buyButton.textContent = "Added to Cart";
        buyButton.textContent.fontsize = "23px";
        buyButton.style.backgroundColor = "#4CAF50"; // Change button color to green
        buyButton.disabled = true; // Optionally disable the button
    }

}

// Function to add products to the wishlist
function addWishList(productId) {
    totalProductsInWishList++; // Increment the total products in wishlist
    updateWishListIcon(); // Update the wishlist icon

    // Change the heart icon to "like-solid"
    const heartButton = document.querySelector(`#wish[data-product-id="${productId}"]`);
    if (heartButton) {
        heartButton.innerHTML = '<i class="fa-solid fa-heart" style="color: #0b48a3;"></i>'; // Change to solid heart
    }

    alert(`Product ${productId} added to WishList!`);
}

// Function to handle search
function performSearch() {
    const searchInput = document.getElementById('searchInput').value;
    if (searchInput) {
        // Redirect to search.html with the search term as a query parameter
        window.location.href = `search.html?query=${encodeURIComponent(searchInput)}`;
    } else {
        alert("Please enter a search term.");
    }
}

// Function to display products in a specified container
function displayProducts(productArray) {
    const productContainer = document.querySelector('.product-flex');
    productContainer.innerHTML = ''; // Clear previous products

    console.log("Filtered products:", productArray); // Log the filtered products

    // Iterate over the product array and create a product card for each item
    productArray.forEach(product => {
        const productCard = document.createElement('div');
        productCard.className = 'product-card';

        // Generate the star rating for each product
        const starsHtml = generateStars(product.rating);

        productCard.innerHTML = `
            <a href="product-detail.html?id=${product.id}">
                <img src="${product.imageUrl}" alt="Product ${product.id}" class="product-image" style="width: 150px;">
                <div class="rating" style="display: flex; align-items: center; margin-top: 10px;">
                    ${starsHtml}
                </div>
                <h5 class="product-name">${product.name}</h5>
                <p class="old-price">${product.oldPrice.toFixed(2)} SR</p>
                <p class="new-price">${product.newPrice.toFixed(2)} SR</p>
            </a>
            <div style="display:flex;">
                <button id="wish" data-product-id="${product.id}" onclick="addWishList(${product.id})" style="border-radius:50px;">
                    <i class="fa-regular fa-heart"></i>
                </button>
                <button id="buy" data-product-id="${product.id}" onclick="buyProduct(${product.id})" style="width:80%; font-size:18px;">
                    Add to Cart &nbsp;<i class="fa-sharp fa-solid fa-cart-plus"></i>
                </button>
            </div>
        `;

        // Append the product card to the container
        productContainer.appendChild(productCard);
    });
}

function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

let selectedStars = [];

// Handle star click events
document.querySelectorAll('.star').forEach(star => {
    star.addEventListener('click', (e) => {
        const selectedRating = parseInt(e.target.getAttribute('data-value'));

        // Update the selectedStars array
        selectedStars = Array.from({ length: selectedRating }, (_, i) => i + 1);

        // Update the visual state of the stars
        updateStars();

        // Call the filter function to apply the filters
        filterAndDisplayResults();
    });
});

function updateStars() {
    // Reset all stars to unselected
    document.querySelectorAll('.star').forEach(star => {
        star.classList.remove('selected');
        star.style.color = ''; // Reset color
    });

    // Mark the selected stars as selected
    document.querySelectorAll('.star').forEach(star => {
        const starValue = parseInt(star.getAttribute('data-value'));
        if (starValue <= selectedStars.length) {
            star.classList.add('selected');
            star.style.color = 'gold'; // Set color to gold for selected stars
        }
    });
}

// Function to filter and display results based on selected filters
document.getElementById('applyFilters').addEventListener('click', function() {
    filterAndDisplayResults(); // Call the filtering function when the button is clicked
});

// Function to filter and display results based on selected filters
function filterAndDisplayResults() {
    const selectedCategories = Array.from(document.querySelectorAll('.category-filter:checked')).map(cb => cb.value);
    const selectedCompanies = Array.from(document.querySelectorAll('.company-filter:checked')).map(cb => cb.value);
    const maxPrice = parseInt(document.getElementById('priceRange').value);
    const query = getQueryParam('query').toLowerCase(); // Ensure to get the search query

    console.log("Applying filters...");
    console.log("Selected Categories:", selectedCategories);
    console.log("Selected Companies:", selectedCompanies);
    console.log("Max Price:", maxPrice);
    console.log("Selected Stars:", selectedStars);

    // Filter the products based on the query, category, company, price, and star ratings
    const filteredProducts = Products.filter(product => {
        const matchesQuery = product.name.toLowerCase().includes(query);
        const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(product.category);
        const matchesCompany = selectedCompanies.length === 0 || selectedCompanies.includes(product.company);
        const matchesPrice = product.newPrice <= maxPrice;

        // Check if the product's rating matches the selected star ratings
        const matchesStars = selectedStars.length === 0 || selectedStars.some(star => product.rating <= star);

        return matchesQuery && matchesCategory && matchesCompany && matchesPrice && matchesStars;
    });

    console.log("Filtered Products:", filteredProducts);
    displayProducts(filteredProducts); // Call to display filtered products
}

// Generate the star HTML (full, half, and empty stars)
function generateStars(rating) {
    const fullStars = Math.floor(rating); // Number of full stars
    const hasHalfStar = rating % 1 !== 0; // Whether there's a half star
    const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0); // Remaining empty stars

    let starsHtml = '';

    // Add full stars
    for (let i = 0; i < fullStars; i++) {
        starsHtml += '<i class="fa-solid fa-star" style="color: gold;"></i>';
    }

    // Add half star if necessary
    if (hasHalfStar) {
        starsHtml += '<i class="fa-solid fa-star-half-alt" style="color: gold;"></i>';
    }

    // Add empty stars
    for (let i = 0; i < emptyStars; i++) {
        starsHtml += '<i class="fa-regular fa-star" style="color: gold;"></i>';
    }

    return starsHtml;
}

// Call this function when the page loads to display the results
window.onload = () => {
    const query = getQueryParam('query');
    document.getElementById('resultsTitle').textContent = `Search Results for: ${query}`;
    filterAndDisplayResults(); // Show the filtered results based on the search
    updateCartIcon();
    updateWishListIcon();
};


        </script>

<script>
    // Check the sign-in status on page load
    const isSignedIn = localStorage.getItem('isSignedIn');
    const isAdmin = localStorage.getItem('isAdmin');
    // Reset sign-in status when the page is being unloaded

    // Update UI based on sign-in status
    function updateSignInUI() {
    const isSignedIn = localStorage.getItem('isSignedIn');
    const isAdmin = localStorage.getItem('isAdmin');
    const avatarLink = document.getElementById('avatar-link');
    const signinLink = document.getElementById('signin-link');
    const addIcon = document.getElementById('add-product');
    const deleteIcon = document.getElementById('delete-product');
    const statIcon = document.getElementById('statistics');
    if (isSignedIn === 'true') {

        if(isAdmin === 'true'){
            avatarLink.style.display = 'block'; // Show the avatar
        signinLink.style.display = 'none';   // Hide the sign-in link
        avatarLink.href = 'profile.html';
        addIcon.style.display="block"; 
        deleteIcon.style.display="block";
        statIcon.style.display="block";
        }
        else{
            avatarLink.style.display = 'block'; // Show the avatar
        signinLink.style.display = 'none';   // Hide the sign-in link
        avatarLink.href = 'profile.html';
        }
         // Change to the desired profile page
    } 
    else {
        avatarLink.style.display = 'none';    // Hide the avatar
        signinLink.style.display = 'block';    // Show the sign-in link
    }
}

    // Call the function to update the UI
    updateSignInUI();
</script>